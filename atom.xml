<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
    <id>https://zwmmm.github.io</id>
    <title>Wayne</title>
    <updated>2020-06-01T02:28:12.363Z</updated>
    <generator>https://github.com/jpmonette/feed</generator>
    <link rel="alternate" href="https://zwmmm.github.io"/>
    <link rel="self" href="https://zwmmm.github.io/atom.xml"/>
    <subtitle>è‡³ç¹å½’è‡³ç®€</subtitle>
    <logo>https://zwmmm.github.io/images/avatar.png</logo>
    <icon>https://zwmmm.github.io/favicon.ico</icon>
    <rights>All rights reserved 2020, Wayne</rights>
    <entry>
        <title type="html"><![CDATA[å‰ç«¯é¢„æ¸²æŸ“æ–¹æ¡ˆ]]></title>
        <id>https://zwmmm.github.io/prerender/</id>
        <link href="https://zwmmm.github.io/prerender/">
        </link>
        <updated>2020-05-29T03:18:27.000Z</updated>
        <summary type="html"><![CDATA[<h2 id="å‰è¨€">ğŸŒµå‰è¨€</h2>
<p>å¼€å‘ä¸€ä¸ªå®˜ç½‘é¡¹ç›®ï¼Œç”±äºä½¿ç”¨ä¼ ç»Ÿçš„å¤šé¡µé¢å¼€å‘æ¨¡å¼ï¼Œä¸åˆ©äºåšä¼˜åŒ–ã€‚</p>
<h2 id="é¢„æ¸²æŸ“">ğŸ„é¢„æ¸²æŸ“</h2>
<p>é€šè¿‡ä½¿ç”¨ <a href="https://github.com/chrisvfritz/prerender-spa-plugin">prerender-spa-plugin</a> ç”Ÿæˆé™æ€é¡µé¢ï¼Œæ—¢æé«˜äº†é¡µé¢æ¸²æŸ“çš„é€Ÿåº¦ï¼Œä¹Ÿåˆ©äº <code>seo</code>ï¼Œä½¿ç”¨æ–¹å¼å¦‚ä¸‹</p>
]]></summary>
        <content type="html"><![CDATA[<h2 id="å‰è¨€">ğŸŒµå‰è¨€</h2>
<p>å¼€å‘ä¸€ä¸ªå®˜ç½‘é¡¹ç›®ï¼Œç”±äºä½¿ç”¨ä¼ ç»Ÿçš„å¤šé¡µé¢å¼€å‘æ¨¡å¼ï¼Œä¸åˆ©äºåšä¼˜åŒ–ã€‚</p>
<h2 id="é¢„æ¸²æŸ“">ğŸ„é¢„æ¸²æŸ“</h2>
<p>é€šè¿‡ä½¿ç”¨ <a href="https://github.com/chrisvfritz/prerender-spa-plugin">prerender-spa-plugin</a> ç”Ÿæˆé™æ€é¡µé¢ï¼Œæ—¢æé«˜äº†é¡µé¢æ¸²æŸ“çš„é€Ÿåº¦ï¼Œä¹Ÿåˆ©äº <code>seo</code>ï¼Œä½¿ç”¨æ–¹å¼å¦‚ä¸‹</p>
<!-- more -->
<pre><code class="language-js">const PrerenderSPAPlugin = require('prerender-spa-plugin');
const Renderer = PrerenderSPAPlugin.PuppeteerRenderer;
const path = require('path');

module.exports = {
    plugins: [new PrerenderSPAPlugin({
        staticDir: path.join(__dirname, 'dist'),
        routes: [ '/' ], // éœ€è¦é¢„æ¸²æŸ“çš„è·¯ç”±,
        renderer: new Renderer({
            headless: true, // å¼€å¯æ— å¤´æµè§ˆå™¨
            renderAfterDocumentEvent: 'render-event', // æ¸²æŸ“çš„äº‹ä»¶ï¼Œåªæœ‰è§¦å‘äº†è¿™ä¸ªäº‹ä»¶ï¼Œæ’ä»¶æ‰ä¼šå¼€å§‹çˆ¬å–html
          }),
    })]
}
</code></pre>
<pre><code class="language-js">// åœ¨ App.vue ä¸­è°ƒç”¨å¦‚ä¸‹æ–¹æ³•ï¼Œäº‹ä»¶åç§°å’Œ renderAfterDocumentEvent ä¿æŒä¸€ç›´ï¼Œå…¶ä»–æ¡†æ¶åœ¨ç±»ä¼¼çš„ç”Ÿå‘½å‘¨æœŸè°ƒç”¨å³å¯
export default {
  mounted() {
    document.dispatchEvent(new Event('render-event'));
  }
};
</code></pre>
<h2 id="è¸©å‘è®°å½•">è¸©å‘è®°å½•</h2>
<h3 id="unable-to-prerender-all-routes">Unable to prerender all routes!</h3>
<p>åœ¨macä¸‹è®¾ç½®äº† headless: false å¯¼è‡´æç¤º <code>Unable to prerender all routes!</code> google äº†ä¸€å †ï¼Œå‘Šè¯‰æˆ‘è¯´ä¸èƒ½ä½¿ç”¨è·¯ç”±æ‡’åŠ è½½ï¼Œå…¶å®é€ æˆè¿™ä¸ªæŠ¥é”™çš„åŸå› æœ‰å¾ˆå¤šï¼Œæˆ‘æ˜¯è®¾ç½®äº†headless: true å°±å¥½äº†<br>
<img src="https://zwmmm.github.io/post-images/1590735278740.jpg" alt="" loading="lazy"></p>
<h3 id="é™æ€èµ„æºä½¿ç”¨äº†cdn">é™æ€èµ„æºä½¿ç”¨äº†cdn</h3>
<p>ç”±äºä½¿ç”¨äº†cdnï¼Œä½†æ˜¯æˆ‘ä»¬è¿˜æ²¡æœ‰å‘å¸ƒï¼Œæ‰€ä»¥cdnä¸Šå¹¶æ²¡æœ‰å¯¹äºçš„èµ„æºï¼Œå¯¼è‡´é¡µé¢åŠ è½½å¤±è´¥ï¼ˆç»ˆç«¯ä¼šä¸€ç›´å¡ä½æ²¡ååº”ï¼‰</p>
<p>è¿™ä¸ªçš„è§£å†³åŠæ³•ï¼Œgoogleä¸€æœä¹Ÿæœ‰å¾ˆå¤šçš„è§£å†³åŠæ³•ï¼Œæ¯”è¾ƒå¥½çš„åŠæ³•å°±æ˜¯ä½¿ç”¨ä»£ç†ï¼Œå°†cdnåœ°å€ä»£ç†åˆ°æœ¬åœ°ã€‚<br>
æˆ‘çœ‹äº†å‡ ç¯‡æ–‡ç« ï¼Œéƒ½æ˜¯é‡æ–°ç”¨nodeèµ·ä¸€ä¸ªä»£ç†æœåŠ¡ï¼Œå…¶å® <code>prerender-spa-plugin</code>  æœ¬èº«å°±å¯ä»¥è®¾ç½®ä»£ç†ã€‚</p>
<p>åªéœ€è¦å°†ä»£ç†æœåŠ¡èµ·çš„ç«¯å£å·æ”¹æˆ80ï¼Œå¹¶ä¸”ä¿®æ”¹æœ¬æœºhostä¸­127.0.0.1çš„æ˜ å°„å°±å¯ä»¥å®ç°ä»£ç†ï¼Œè¿™æ ·è®¾ç½®ä»¥åï¼Œè¯·æ±‚ <code>xxx.cdn.com/static/1.txt</code> å°±ç­‰äº <code>127.0.0.1/static/1.txt</code></p>
<p>å…·ä½“ä»£ç å¦‚ä¸‹ï¼š</p>
<pre><code class="language-diff">// webpack.config.js
const PrerenderSPAPlugin = require('prerender-spa-plugin');
const Renderer = PrerenderSPAPlugin.PuppeteerRenderer;
const path = require('path');

module.exports = {
    plugins: [new PrerenderSPAPlugin({
        staticDir: path.join(__dirname, 'dist'),
        routes: [ '/' ], // éœ€è¦é¢„æ¸²æŸ“çš„è·¯ç”±,
        renderer: new Renderer({
            headless: true, // å¼€å¯æ— å¤´æµè§ˆå™¨
            renderAfterDocumentEvent: 'render-event', // æ¸²æŸ“çš„äº‹ä»¶ï¼Œåªæœ‰è§¦å‘äº†è¿™ä¸ªäº‹ä»¶ï¼Œæ’ä»¶æ‰ä¼šå¼€å§‹çˆ¬å–html
        }),
     + server: {
     +     port: 80, // è®¾ç½®ç«¯å£ä¸º80
     +     proxy: {
     +       '/static: {
     +         target: `http://localhost`,
     +         changeOrigin: true,
     +         pathRewrite: {
     +           '^/static': '/'
     +         }
     +       }
     +    }
     + }
    })]
}
</code></pre>
<p>ç°åœ¨åªæœ‰æœ€åä¸€æ­¥äº†ï¼Œä¿®æ”¹hostè¿™ä¸ªæ“ä½œæ€»ä¸èƒ½æ¯æ¬¡æ‰‹åŠ¨æ¥å§ï¼Œæˆ‘ä»¬ç°åœ¨å†™ä¸€ä¸ªnodeè„šæœ¬å¸®æˆ‘ä»¬åšè¿™ä¸ªäº‹æƒ…</p>
<pre><code class="language-js">// build.js
const util = require('util');
const exec = util.promisify(require('child_process').exec);
const hostile = require('hostile');

const  cdnDomain = 'xxx.cdn.com';

process.env.FORCE_COLOR = true; // å¼€å¯æ§åˆ¶å°æ‰“å°çš„é¢œè‰²

hostile.set('127.0.0.1', cdnDomain, async () =&gt; {
  const { stdout, stderr } = await exec('vue-cli-service build');
  console.log(stdout);
  console.log(stderr);
  hostile.remove('127.0.0.1', cdnDomain, () =&gt; process.exit(0));
});
</code></pre>
<p>æœ€å <code>node build.js</code> å®Œæˆæ‰“åŒ…</p>
<h3 id="ä»£ç†äº†cdnå¸¦æ¥çš„é—®é¢˜">ä»£ç†äº†cdnå¸¦æ¥çš„é—®é¢˜</h3>
<p>æœ¬æ¥ä»¥ä¸ºå·²ç»å®Œç¾è§£å†³cdnçš„é—®é¢˜äº†ï¼Œä½†æ˜¯å½“æˆ‘ä»¬æŸäº›èµ„æºåœ¨cdnä¸­å­˜åœ¨ï¼Œè€Œåœ¨æœ¬åœ°ä¸å­˜åœ¨ï¼Œä½¿ç”¨ä»£ç†åè€Œä¼šå‡ºç°é—®é¢˜ã€‚</p>
<p>æˆ‘é‡åˆ°çš„é—®é¢˜æ˜¯è¿™æ ·çš„ï¼Œä¸ºäº†ä¼˜åŒ–ä»£ç çš„ä½“ç§¯ï¼Œå°† <code>vue vue-router swiper</code> ç­‰ä¾èµ–å¤–ç½®ï¼Œä½¿ç”¨cdnçš„æ–¹å¼å¼•å…¥ï¼Œè€Œæˆ‘æœ¬åœ°å´æ²¡æœ‰è¿™äº›æ–‡ä»¶ã€‚ç”±äºä¿®æ”¹äº†hostï¼Œå·²ç»æ²¡æœ‰å…¶ä»–åŠæ³•åœ¨è®¿é—®åˆ°cdnä¸Šçš„èµ„æºäº†ã€‚</p>
<p>æœ€ç»ˆçš„è§£å†³åŠæ³•å¾ˆç¬¨ï¼Œåœ¨ <code>public</code> æ–‡ä»¶å¤¹ä¸­å­˜æ”¾è¿™äº›æ–‡ä»¶ï¼Œä¿è¯é€šè¿‡ä»£ç†ä¹Ÿèƒ½è®¿é—®åˆ°ï¼Œç„¶åä½¿ç”¨ git å¿½ç•¥è¿™éƒ¨åˆ†æ–‡ä»¶ï¼Œé¿å…å‘å¸ƒå‡ºå»ã€‚</p>
]]></content>
    </entry>
</feed>